import{r as _,i as L,j as e,R as G,ar as K,a as d,B as s,c as C,n as j,N as U,b as M,T as u,aV as b,M as H}from"./index-fCbYz-6P.js";import{A as Y,T as Q}from"./TablePagination-hGNVGNlY.js";import{d as J}from"./Edit-DttvWJeg.js";import{D as O,a as V,b as W}from"./DialogContent-BomaAlaV.js";import{D as E}from"./DialogTitle-ovlwR2kQ.js";import{T as S}from"./TextField-D13pBZMm.js";import{G as f}from"./Grid-BhrwLh7C.js";import{F as X}from"./FormControlLabel-CKWm9ZMF.js";import{S as Z}from"./Switch-DQFqkRTg.js";import"./Chip-BAZYjULl.js";import"./Tooltip-CTC8kJf2.js";import"./useThemeProps-Cz-DRPQp.js";import"./InputAdornment-DzH7OAyS.js";import"./KeyboardArrowRight-CeattqcP.js";import"./SwitchBase-CxMVVAa1.js";var P={},ee=L;Object.defineProperty(P,"__esModule",{value:!0});var F=P.default=void 0,te=ee(_()),ie=e;F=P.default=(0,te.default)((0,ie.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m4 11h-3v3c0 .55-.45 1-1 1s-1-.45-1-1v-3H8c-.55 0-1-.45-1-1s.45-1 1-1h3V8c0-.55.45-1 1-1s1 .45 1 1v3h3c.55 0 1 .45 1 1s-.45 1-1 1"}),"AddCircleRounded");const ae=G.forwardRef(function(o,h){return e.jsx(K,{direction:"up",ref:h,...o})}),re=({open:c,onClose:o,onSearch:h})=>{const[g,p]=d.useState(""),[D,y]=d.useState([]),[i,l]=d.useState(null),v=(a,r)=>{p(r),r.trim()&&j.get("/api/v2/product/search",{params:{keyword:r,page:1,size:50}}).then(m=>{y(m.data.data.data||[])}).catch(m=>{console.error("Error fetching products:",m)})},n=(a,r)=>{r&&(l(r),h(r.productId),o())};return e.jsxs(O,{TransitionComponent:ae,maxWidth:"lg",open:c,onClose:o,children:[e.jsx(E,{width:"100%",children:"Tìm kiếm sản phẩm"}),e.jsx(V,{width:"100%",children:e.jsx(Y,{autoFocus:!0,sx:{width:"50vw"},value:i,onInputChange:v,onChange:n,options:D,getOptionLabel:a=>a.productName||"",renderInput:a=>e.jsx(S,{...a,fullWidth:!0,variant:"outlined"}),renderOption:(a,r)=>d.createElement(s,{...a,key:r.productId},e.jsx("img",{src:r.image,alt:r.productName,style:{width:30,height:30,marginRight:10}}),r.productName," - ",r.productId)})}),e.jsx(W,{children:e.jsx(C,{onClick:o,color:"primary",children:"Đóng"})})]})},R=new U({position:{x:"right",y:"top"},dismissible:!0}),A=c=>c?new Date(c).toISOString().slice(0,16):"",ne=({open:c,onClose:o,productId:h,discountId:g,isCreate:p=!1})=>{const D=M(),y={productName:"Loading...",image:"https://via.placeholder.com/150",price:0},[i,l]=d.useState({product:y,discountRate:0,startDate:"",endDate:"",active:!0});d.useEffect(()=>{if(p&&c){j.get(`/api/product/${h}`).then(n=>{l({...i,product:n.data.data,startDate:"",endDate:"",discountRate:0,active:!0})});return}c&&j.get(`/api/discount/${g}`).then(n=>{const a=n.data.data;l({product:{productName:a.productName,image:a.image,price:a.price,productId:a.productId},discountRate:a.discountRate*100,startDate:A(a.startDate),endDate:A(a.endDate),active:a.active,id:a.id})})},[c,g,h,p]);const v=async()=>{const{discountRate:n,startDate:a,endDate:r,discountedPrice:m,active:N}=i;if(!n||!a||!r){alert("Vui lòng điền đầy đủ thông tin!");return}let x={id:g,productId:h,discountRate:parseFloat(n)/100,startDate:a,endDate:r,active:N};try{p?(await j.post("/api/discount/create",x),R.success("Thêm khuyến mãi thành công!")):(x={...x,productId:i.product.productId,id:i.id},await j.put("/api/discount/update",x),R.success("Cập nhật khuyến mãi thành công!")),await D(b({page:1,size:10})),o()}catch(I){R.error(I.response.data.message)}};return e.jsxs(O,{open:c,onClose:o,children:[e.jsx(E,{children:p?"THÊM KHUYẾN MÃI CHO SẢN PHẨM":"CẬP NHẬT KHUYẾN MÃI"}),e.jsx(V,{children:e.jsxs(f,{container:!0,spacing:2,children:[e.jsxs(f,{item:!0,xs:12,display:"flex",alignItems:"center",children:[e.jsx(s,{component:"img",src:i.product.image,alt:i.product.productName,sx:{width:"100px",height:"80px",marginRight:2}}),e.jsxs(s,{children:[e.jsx(u,{variant:"h6",children:i.product.productName}),e.jsxs(s,{display:"flex",alignItems:"center",children:[e.jsxs(u,{variant:"body1",color:"textSecondary",sx:{textDecoration:i.discountRate?"line-through":"none",color:i.discountRate?"red":"black",fontStyle:i.discountRate?"italic":"normal",marginRight:2},children:[i.product.price.toLocaleString()," VNĐ"]}),i.discountRate>0&&e.jsxs(u,{variant:"body1",color:"primary",children:[(i.product.price*(1-i.discountRate/100||0)).toLocaleString()," ","VNĐ"]})]})]})]}),e.jsx(f,{item:!0,xs:12,children:e.jsx(S,{label:"Tỷ lệ giảm giá (%)",fullWidth:!0,value:i.discountRate,onChange:n=>l({...i,discountRate:n.target.value}),variant:"outlined",type:"number",InputProps:{inputProps:{min:0,max:100}}})}),e.jsx(f,{item:!0,xs:12,children:e.jsx(S,{label:"Ngày bắt đầu",fullWidth:!0,value:i.startDate,onChange:n=>l({...i,startDate:n.target.value}),variant:"outlined",type:"datetime-local",InputLabelProps:{shrink:!0}})}),e.jsx(f,{item:!0,xs:12,children:e.jsx(S,{label:"Ngày kết thúc",fullWidth:!0,value:i.endDate,onChange:n=>l({...i,endDate:n.target.value}),variant:"outlined",type:"datetime-local",InputLabelProps:{shrink:!0}})}),e.jsx(f,{item:!0,xs:12,children:e.jsx(X,{control:e.jsx(Z,{checked:i.active,onChange:n=>l({...i,active:n.target.checked}),name:"active"}),label:"Active"})})]})}),e.jsxs(W,{children:[e.jsx(C,{onClick:o,color:"primary",children:"Hủy"}),e.jsx(C,{onClick:v,color:"primary",children:"Lưu"})]})]})};var T={},se=L;Object.defineProperty(T,"__esModule",{value:!0});var $=T.default=void 0,oe=se(_()),ce=e;$=T.default=(0,oe.default)((0,ce.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V9c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2zM18 4h-2.5l-.71-.71c-.18-.18-.44-.29-.7-.29H9.91c-.26 0-.52.11-.7.29L8.5 4H6c-.55 0-1 .45-1 1s.45 1 1 1h12c.55 0 1-.45 1-1s-.45-1-1-1"}),"DeleteRounded");function Ne(){const[c,o]=d.useState(!1),[h,g]=d.useState(!1),[p,D]=d.useState(null),[y,i]=d.useState(null),[l,v]=d.useState(!1),n=M(),a=()=>{o(!0)},r=()=>{o(!1)},m=t=>{g(!0),v(t)},N=()=>{g(!1)},x=t=>{D(t),console.log("Selected product ID:",t),r(),m(!0)},I=t=>{i(t.id),m(!1)},B=async t=>{await j.delete(`/api/discount/delete/${t.id}`),n(b({page:1,size:10}))},k=t=>{const w={year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"};return new Date(t).toLocaleString("vi-VN",w)},q=d.useMemo(()=>[{field:"id",headerName:"ID",width:10},{field:"productId",headerName:"ID Sản phẩm",width:100},{field:"productName",headerName:"Tên sản phẩm",width:150},{field:"image",headerName:"Ảnh",headerAlign:"center",width:150,renderCell:t=>e.jsx(s,{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",children:e.jsx("img",{src:t.row.image,alt:"Product",style:{width:"50px",height:"50px",objectFit:"cover"}})})},{field:"price",headerName:"Giá gốc (VNĐ)",width:150,renderCell:t=>e.jsx(s,{display:"flex",justifyContent:"left",alignItems:"center",height:"100%",children:e.jsxs(u,{children:[t.row.price.toLocaleString("vi-VN")," đ"]})})},{field:"discountRate",headerName:"Tỉ lệ giảm",width:100,renderCell:t=>e.jsxs(s,{display:"flex",justifyContent:"left",alignItems:"center",height:"100%",children:[e.jsxs(u,{children:[(t.row.discountRate*100).toFixed(2),"%"]}),","]})},{field:"priceAfter",headerName:"Giá đã giảm (VNĐ)",width:150,renderCell:t=>{const w=t.row.price-t.row.price*t.row.discountRate;return e.jsx(s,{display:"flex",justifyContent:"left",alignItems:"center",height:"100%",children:e.jsxs(u,{sx:{color:"#c4943c",fontWeight:"bold"},children:[w.toLocaleString("vi-VN")," đ"]})})}},{field:"startDate",headerName:"Bắt đầu",width:170,headerAlign:"center",renderCell:t=>e.jsx(s,{display:"flex",justifyContent:"left",alignItems:"center",height:"100%",children:e.jsx(u,{textAlign:"center",children:k(t.row.startDate)})})},{field:"endDate",headerName:"Kết thúc",width:170,headerAlign:"center",renderCell:t=>{const w=new Date,z=new Date(t.row.endDate)<w;return e.jsx(s,{display:"flex",justifyContent:"left",alignItems:"center",height:"100%",children:e.jsx(u,{textAlign:"center",sx:{color:z?"red":"green",fontWeight:"bold"},children:k(t.row.endDate)})})}},{field:"active",headerName:"Trạng thái",width:150,renderCell:t=>e.jsx(s,{display:"flex",justifyContent:"left",alignItems:"center",height:"100%",children:e.jsx(u,{sx:{color:t.row.active?"green":"red",fontWeight:"bold"},children:t.row.active?"Đang hoạt động":"Đã dừng"})})},{field:"actions",headerName:"Công cụ",width:150,renderCell:t=>e.jsxs(s,{display:"flex",justifyContent:"left",alignItems:"center",height:"100%",children:[e.jsx(H,{color:"primary",onClick:()=>I(t.row),children:e.jsx(J,{})}),e.jsx(H,{color:"primary",onClick:()=>B(t.row),children:e.jsx($,{})})]})}],[]);return e.jsxs(s,{sx:{padding:"20px 30px"},children:[e.jsxs(s,{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:3,children:[e.jsx(u,{variant:"h4",component:"h2",fontWeight:"bold",color:"inherit",children:"DANH SÁCH KHUYẾN MÃI"}),e.jsx(C,{variant:"contained",color:"success",startIcon:e.jsx(F,{}),onClick:a,sx:{marginBottom:"10px"},children:"Thêm mới"})]}),e.jsx(Q,{columns:q,id:"id",dispatchHandle:b,sliceName:"discount"}),e.jsx(re,{open:c,onClose:r,onSearch:x}),e.jsx(ne,{open:h,onClose:N,productId:p,discountId:y,isCreate:l})]})}export{Ne as default};
