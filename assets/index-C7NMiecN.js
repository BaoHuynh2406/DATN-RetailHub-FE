import{c as P,d as S,e as E,a as A,f as B,u as G,r as l,j as a,P as V,B as k,T as C,b as v}from"./index-DP8KUik0.js";import{d as D}from"./LockOutlined-rpF_49A8.js";import{G as h}from"./Grid-DYDRhpgO.js";import{A as I}from"./Avatar-DphCwLWf.js";import{T as u}from"./TextField-wt1h2hNg.js";const N={loading:!1,data:null,error:null},c=P("userCurrent/sendResetPasswordCode",async(t,{rejectWithValue:e})=>{var r,o;try{return(await S.post("/api-public/auth/send-otp",{email:t})).data.message}catch(s){return e(((o=(r=s.response)==null?void 0:r.data)==null?void 0:o.message)||"Failed to send reset code")}}),m=P("/api-public/auth/verify-otp",async(t,{rejectWithValue:e})=>{var r,o;try{return(await S.post("/api-public/auth/verify-otp",t)).data.message}catch(s){return e(((o=(r=s.response)==null?void 0:r.data)==null?void 0:o.message)||"Failed to reset password")}});E({name:"userCurrent",initialState:N,reducers:{},extraReducers:t=>{t.addCase(c.pending,e=>{e.loading=!0,e.error=null}).addCase(c.fulfilled,(e,r)=>{e.loading=!1,e.data=r.payload}).addCase(c.rejected,(e,r)=>{e.loading=!1,e.error=r.payload}).addCase(m.pending,e=>{e.loading=!0,e.error=null}).addCase(m.fulfilled,(e,r)=>{e.loading=!1,e.data=r.payload}).addCase(m.rejected,(e,r)=>{e.loading=!1,e.error=r.payload})}});function H(){const t=A(),{loading:e,error:r,data:o}=B(n=>n.userCurrent),s=G(),f=l.useRef(null),g=l.useRef(null),x=l.useRef(null),y=l.useRef(null),[p,F]=l.useState(1),[W,q]=l.useState(""),M=async()=>{const n=f.current.value;if(!n){alert("Vui lòng nhập email!");return}try{await t(c(n)).unwrap(),alert("Mã xác nhận đã được gửi!"),q(n),F(2)}catch(i){alert(i)}},T=async()=>{var j,b,R;const n=(j=x.current)==null?void 0:j.value,i=(b=g.current)==null?void 0:b.value,w=(R=y.current)==null?void 0:R.value;if(!i||!w){alert("Vui lòng nhập đầy đủ thông tin!");return}if(i!==w){alert("Mật khẩu xác nhận không khớp!");return}try{const d={otp:n,newPassword:i,email:W};console.log("Payload gửi đi:",d),await t(m(d)).unwrap(),alert("Mật khẩu đã được đặt lại thành công!"),s("/login")}catch(d){alert(d)}};return a.jsxs(h,{container:!0,component:"main",sx:{height:"100vh"},children:[a.jsx(h,{item:!0,xs:!1,sm:4,md:7,sx:{backgroundImage:"url(/assets/images/background.png)",backgroundSize:"cover",backgroundPosition:"left"}}),a.jsx(h,{item:!0,xs:12,sm:8,md:5,component:V,elevation:6,square:!0,children:a.jsxs(k,{sx:{my:8,mx:4,display:"flex",flexDirection:"column",alignItems:"center"},children:[a.jsx(I,{sx:{m:1,bgcolor:"secondary.main"},children:a.jsx(D,{})}),a.jsx(C,{component:"h1",variant:"h5",children:p===1?"Khôi phục mật khẩu":"Đặt mật khẩu mới"}),a.jsxs(k,{component:"form",noValidate:!0,sx:{mt:1},children:[p===1&&a.jsxs(a.Fragment,{children:[a.jsx(u,{margin:"normal",required:!0,fullWidth:!0,id:"email",label:"Nhập email",name:"email",autoComplete:"email",autoFocus:!0,inputRef:f}),a.jsx(v,{onClick:M,fullWidth:!0,variant:"contained",sx:{mt:3,mb:2},disabled:e,children:e?"Đang gửi...":"Gửi mã"})]}),p===2&&a.jsxs(a.Fragment,{children:[a.jsx(u,{margin:"normal",required:!0,fullWidth:!0,id:"otp",label:"Mã xác nhận",type:"otp",inputRef:x}),a.jsx(u,{margin:"normal",required:!0,fullWidth:!0,id:"new-password",label:"Mật khẩu mới",type:"password",inputRef:g}),a.jsx(u,{margin:"normal",required:!0,fullWidth:!0,id:"confirm-password",label:"Xác nhận mật khẩu",type:"password",inputRef:y}),a.jsx(v,{onClick:T,fullWidth:!0,variant:"contained",sx:{mt:3,mb:2},disabled:e,children:e?"Đang xử lý...":"Đặt lại mật khẩu"})]}),r&&a.jsx(C,{color:"error",children:r})]})]})})]})}export{H as default};
