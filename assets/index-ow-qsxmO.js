import{a3 as K,a as V,f as C,r as o,a4 as E,u as Y,a5 as q,a6 as X,a7 as J,j as e,B as y,C as Q,T as w,b as u,a8 as ee,a9 as te,aa as ae,ab as re,$ as ne,Z as le}from"./index-DP8KUik0.js";import{d as A}from"./Badge-CY6dZHgp.js";import{d as se}from"./ReplyAll-D012kb6H.js";import{u as ie}from"./useImgBB-Bg-eOmgg.js";import{C as oe}from"./Container-CJKjEmvN.js";import{G as b}from"./Grid-DYDRhpgO.js";import{T as R}from"./Tooltip-BGGRBVqn.js";import{T as i}from"./TextField-wt1h2hNg.js";import{I as W}from"./InputAdornment-BB7_Xr8N.js";import{S as de}from"./Switch-DhSWMwzF.js";import"./useThemeProps-RlFDv_1a.js";import"./SwitchBase-BEEy8CUH.js";const d=new K({position:{x:"right",y:"top"},dismissible:!0}),ce="https://via.placeholder.com/400x300?text=No+Image",we=()=>{var T,D;const c=V(),{data:S,currentData:j,loading:N,error:v}=C(a=>a.employeeNew),f=C(a=>a.userCurrent),F=C(a=>a.settings.roles),{handleUpload:B}=ie(),[L,m]=o.useState(!1);let{userId:n}=E();const p=Y(),[x,P]=o.useState(null),I={userId:"",fullName:"",email:"",phoneNumber:"",address:"",image:"",startDate:"",endDate:"",birthday:"",isActive:!0,isDelete:!1,password:"",role:{roleId:"",roleDescription:""}},[t,g]=o.useState(I),[r,z]=o.useState({});o.useEffect(()=>{if(n==="create"){g(I);return}if(S.length){c(q(n));return}c(X(n))},[E()]),o.useEffect(()=>{j&&n!=="create"&&g(j)},[j]),o.useEffect(()=>{m(!!N)},[N]),o.useEffect(()=>{if(v){if(d.error(v),console.log(v),v==="User not found"){p("/employee/EmployeeDetail/create");return}p(0)}},[v]),o.useEffect(()=>{c(J())},[]);const s=a=>{const{name:l,value:h}=a.target;g(l==="roleId"?{...t,role:{...t.role,roleId:h}}:{...t,[l]:h})},M=a=>{const l=a.target.files[0];P(l);const h=new FileReader;h.onloadend=()=>{g({...t,image:h.result})},l&&h.readAsDataURL(l)},U=async()=>{if(!x)throw new Error("No file selected");if(!x.type.startsWith("image/"))throw d.error("Chỉ nhận file ảnh"),new Error("Invalid file type");const a="UserImage-"+x.name.substring(0,x.name.lastIndexOf(".")).normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g,"").toLowerCase();return await B(x,a)},k=async()=>{if(!H()){d.error("Vui lòng kiểm tra các trường bắt buộc");return}m(!0);let a={...t,roleId:t.role.roleId};if(x)try{const l=await U();a={...a,image:l}}catch{d.error("Không thể tải ảnh lên"),m(!1);return}try{if(n==="create"){await c(te(a)).unwrap(),d.success("Đã thêm!"),m(!1),p(0);return}await c(ae(a)).unwrap(),m(!1),d.success("Đã cập nhật!")}catch(l){d.error("Lỗi trong quá trình lưu!"),m(!1),console.log(l)}},$=()=>{n!=="create"?c(re(n)).unwrap().then(()=>{d.success("Đã xóa!"),p("/employee")}):console.log("Lỗi khi xóa nhân viên có userId: ",n)},O=()=>{n!=="create"?(c(ne(n)),d.success("Đã khôi phục!"),p("/employee")):console.log("Lỗi khi khôi phục nhân viên có userId: ",n)},Z=()=>{g(I)},_=()=>p(-1),G=()=>{g({...t,isActive:!t.isActive}),n!=="create"&&c(le(t.userId))},H=()=>{const a={};t.fullName||(a.fullName="Họ và tên là bắt buộc");const l=/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;(!t.email||!l.test(t.email))&&(a.email="Email không hợp lệ");const h=/^[0-9]{10,11}$/;return(!t.phoneNumber||!h.test(t.phoneNumber))&&(a.phoneNumber="Số điện thoại không hợp lệ"),t.password&&t.password.length<6&&(a.password="Mật khẩu phải có ít nhất 6 ký tự"),t.birthday?new Date().getFullYear()-new Date(t.birthday).getFullYear()<18&&(a.birthday="Nhân viên phải từ 18 tuổi trở lên"):a.birthday="Ngày sinh là bắt buộc",t.address||(a.address="Địa chỉ là bắt buộc"),z(a),Object.keys(a).length===0};return e.jsx(oe,{maxWidth:"xl",children:e.jsxs(y,{position:"relative",children:[L&&e.jsx(y,{sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(255, 255, 255, 0.7)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:10},children:e.jsx(Q,{})}),e.jsxs(y,{display:"flex",alignItems:"center",justifyContent:"space-between",sx:{marginBottom:2},marginTop:"20px",children:[e.jsx(w,{variant:"h4",align:"left",gutterBottom:!0,sx:{fontWeight:"bold"},children:n==="create"?"Tạo Mới":`Nhân viên: ${t.fullName}`}),e.jsx(u,{variant:"contained",onClick:_,children:e.jsx(se,{})})]}),e.jsxs(b,{container:!0,spacing:4,children:[e.jsxs(b,{item:!0,xs:12,md:4,children:[e.jsx(R,{title:"Trường này không được thay đổi!",placement:"top-start",children:e.jsx(i,{label:"Mã nhân viên",name:"userId",value:t.userId||"",onChange:s,fullWidth:!0,variant:"outlined",disabled:!0,InputProps:{readOnly:n!=="create",endAdornment:e.jsx(W,{position:"end",children:e.jsx(A,{})})},margin:"normal"})}),e.jsx(i,{label:"Họ và tên",name:"fullName",value:t.fullName||"",onChange:s,fullWidth:!0,variant:"outlined",margin:"normal",error:!!r.fullName,helperText:r.fullName}),e.jsx(i,{label:"Email",name:"email",value:t.email||"",onChange:s,fullWidth:!0,variant:"outlined",margin:"normal",error:!!r.email,helperText:r.email}),e.jsx(i,{label:"Số điện thoại",name:"phoneNumber",value:t.phoneNumber||"",onChange:s,fullWidth:!0,type:"number",variant:"outlined",margin:"normal",error:!!r.phoneNumber,helperText:r.phoneNumber}),e.jsx(i,{label:"Địa chỉ",name:"address",value:t.address||"",onChange:s,fullWidth:!0,variant:"outlined",margin:"normal",error:!!r.address,helperText:r.address}),e.jsx(i,{label:"Ngày sinh",name:"birthday",type:"date",value:t.birthday||"",onChange:s,fullWidth:!0,variant:"outlined",margin:"normal",InputLabelProps:{shrink:!0},error:!!r.birthday,helperText:r.birthday})]}),e.jsxs(b,{item:!0,xs:12,md:4,children:[e.jsx(i,{label:"CCCD",name:"cccd",value:"Chưa hỗ trợ",onChange:s,fullWidth:!0,variant:"outlined",margin:"normal",InputProps:{endAdornment:e.jsx(W,{position:"end",children:e.jsx(A,{})})}}),e.jsx(i,{label:"Mật khẩu",name:"password",type:"password",value:t.password||"",onChange:s,fullWidth:!0,variant:"outlined",margin:"normal",error:!!r.password,helperText:r.password}),e.jsx(i,{select:!0,label:"Vai trò",name:"roleId",value:t.role.roleId||"",onChange:s,fullWidth:!0,variant:"outlined",margin:"normal",children:F.map(a=>e.jsx(ee,{value:a.roleId,children:a.roleDescription},a.roleId))}),e.jsx(i,{label:"Ngày bắt đầu",name:"startDate",type:"date",value:t.startDate||"",onChange:s,fullWidth:!0,variant:"outlined",margin:"normal",InputLabelProps:{shrink:!0},error:!!r.startDate,helperText:r.startDate}),e.jsx(i,{label:"Ngày kết thúc",name:"endDate",type:"date",value:t.endDate||"",onChange:s,fullWidth:!0,variant:"outlined",margin:"normal",InputLabelProps:{shrink:!0},error:!!r.endDate,helperText:r.endDate}),e.jsxs(y,{className:"mt-2 ms-1",display:"flex",alignItems:"center",children:[e.jsx(w,{sx:{marginRight:2,fontWeight:"bold"},children:"Trạng thái hoạt động:"}),e.jsx(R,{title:t.isActive?"Tài khoản này đang hoạt động":"Tài khoản này bị chặn hoạt động",placement:"top",children:e.jsx(de,{disabled:(t==null?void 0:t.userId)===((T=f==null?void 0:f.data)==null?void 0:T.userId)||!1,checked:t.isActive,onChange:G,color:"secondary",name:"active"})})]})]}),e.jsx(b,{item:!0,xs:12,md:4,children:e.jsxs(y,{display:"flex",flexDirection:"column",alignItems:"center",paddingTop:"20px",children:[e.jsx("img",{src:t.image||ce,alt:"Employee",style:{width:"100%",height:"300px",objectFit:"cover",borderRadius:"8px"}}),e.jsx(w,{variant:"caption",color:"textSecondary",sx:{marginTop:1,textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap",width:"100%",textAlign:"center"},children:t.image?"Tên ảnh: "+t.image.split("/").pop():"Chưa có ảnh"}),e.jsxs(u,{variant:"contained",component:"label",sx:{marginTop:2},children:["Chọn ảnh",e.jsx("input",{type:"file",hidden:!0,onChange:M})]})]})})]}),e.jsx(y,{display:"flex",justifyContent:"flex-start",marginTop:5,marginBottom:5,children:n==="create"?e.jsxs(e.Fragment,{children:[e.jsx(u,{variant:"contained",color:"primary",onClick:k,sx:{marginRight:2},children:"Lưu"}),e.jsx(u,{variant:"outlined",onClick:Z,children:"Làm lại"})]}):e.jsxs(e.Fragment,{children:[e.jsx(u,{variant:"contained",color:"primary",onClick:()=>{p("/employee/EmployeeDetail/create")},sx:{marginRight:2},children:"Thêm mới"}),e.jsx(u,{variant:"contained",color:"success",onClick:k,sx:{marginRight:2},children:"Lưu thay đổi"}),t.isDelete?e.jsx(u,{variant:"outlined",color:"info",onClick:O,sx:{marginRight:2},children:"Khôi phục"}):e.jsx(u,{disabled:t.userId===((D=f==null?void 0:f.data)==null?void 0:D.userId)||!1,variant:"outlined",color:"error",onClick:$,sx:{marginRight:2},children:"Xóa"})]})})]})})};export{we as default};
